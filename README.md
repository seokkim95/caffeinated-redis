# Spring Boot Starter Near Cache

ë¶„ì‚° í™˜ê²½ì„ ê³ ë ¤í•œ Multi-Level Cache (Near-Cache) ë¼ì´ë¸ŒëŸ¬ë¦¬

## ğŸ“‹ ê°œìš”

ì´ ë¼ì´ë¸ŒëŸ¬ë¦¬ëŠ” Spring Boot ê¸°ë°˜ì˜ MSA í™˜ê²½ì—ì„œ **ë„¤íŠ¸ì›Œí¬ ë¹„ìš© ì ˆê°**ê³¼ **ì‘ë‹µ ì†ë„ í–¥ìƒ**ì„ ìœ„í•´ 
L1(Local/Caffeine) + L2(Global/Redis) ê³„ì¸µí˜• ìºì‹œë¥¼ ì œê³µí•©ë‹ˆë‹¤.

### ì£¼ìš” íŠ¹ì§•

- **2ë‹¨ê³„ ìºì‹œ**: L1(Caffeine) + L2(Redis) ê³„ì¸µ êµ¬ì¡°
- **ìë™ ì„¤ì •**: `@Cacheable` ì–´ë…¸í…Œì´ì…˜ë§Œìœ¼ë¡œ ë™ì‘
- **ë¶„ì‚° í™˜ê²½ ì§€ì›**: Redis Pub/Subì„ í†µí•œ ìºì‹œ ë¬´íš¨í™” ë¸Œë¡œë“œìºìŠ¤íŒ…
- **ìœ ì—°í•œ ì„¤ì •**: ì „ì—­ ì„¤ì • ë° ìºì‹œë³„ ê°œë³„ ì„¤ì • ì§€ì›

## ğŸ—ï¸ ì•„í‚¤í…ì²˜

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      Application                             â”‚
â”‚                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ @Cacheableâ”‚â”€â”€â”€â–¶â”‚        TwoLevelCacheManager          â”‚   â”‚
â”‚  â”‚ @CacheEvictâ”‚   â”‚                                      â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚   â”‚
â”‚                   â”‚  â”‚        TwoLevelCache           â”‚  â”‚   â”‚
â”‚                   â”‚  â”‚                                â”‚  â”‚   â”‚
â”‚                   â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚   â”‚
â”‚                   â”‚  â”‚  â”‚ L1 Cache â”‚  â”‚ L2 Cache  â”‚  â”‚  â”‚   â”‚
â”‚                   â”‚  â”‚  â”‚(Caffeine)â”‚  â”‚  (Redis)  â”‚  â”‚  â”‚   â”‚
â”‚                   â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚   â”‚
â”‚                   â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚   â”‚
â”‚                   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Redis Pub/Sub                             â”‚
â”‚                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
â”‚  â”‚     Publisher      â”‚â”€â”€â”€â–¶â”‚  Invalidation Msg  â”‚           â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
â”‚                                       â”‚                      â”‚
â”‚                            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
â”‚                            â”‚     Subscriber      â”‚           â”‚
â”‚                            â”‚  (Other Instances)  â”‚           â”‚
â”‚                            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ”„ ìºì‹œ íë¦„

### ì½ê¸° (Read)
```
1. L1(Caffeine)ì—ì„œ ì¡°íšŒ
   â””â”€ HIT  â†’ ë°˜í™˜
   â””â”€ MISS â†’ 2. L2(Redis)ì—ì„œ ì¡°íšŒ
              â””â”€ HIT  â†’ L1ì— ì €ì¥ í›„ ë°˜í™˜
              â””â”€ MISS â†’ ìºì‹œ ë¯¸ìŠ¤ (DB ì¡°íšŒ)
```

### ì“°ê¸°/ë¬´íš¨í™” (Write/Evict)
```
1. L1, L2 ëª¨ë‘ ë¬´íš¨í™”
2. Redis Pub/Subìœ¼ë¡œ ë‹¤ë¥¸ ì¸ìŠ¤í„´ìŠ¤ì— ë¸Œë¡œë“œìºìŠ¤íŠ¸
3. ë‹¤ë¥¸ ì¸ìŠ¤í„´ìŠ¤ëŠ” L1ë§Œ ë¬´íš¨í™” (L2ëŠ” ì´ë¯¸ ë¬´íš¨í™”ë¨)
```

## ğŸš€ ì‚¬ìš© ë°©ë²•

### 1. ì˜ì¡´ì„± ì¶”ê°€

```xml
<dependency>
    <groupId>dev.skim</groupId>
    <artifactId>spring-boot-starter-near-cache</artifactId>
    <version>1.0.0-SNAPSHOT</version>
</dependency>
```

### 2. Redis ì„¤ì •

```yaml
spring:
  data:
    redis:
      host: localhost
      port: 6379
```

### 3. ìºì‹œ ì‚¬ìš©

```java
@Service
public class UserService {

    @Cacheable(value = "users", key = "#id")
    public User findById(Long id) {
        return userRepository.findById(id).orElse(null);
    }

    @CacheEvict(value = "users", key = "#user.id")
    public User save(User user) {
        return userRepository.save(user);
    }

    @CacheEvict(value = "users", allEntries = true)
    public void clearAllUsers() {
        // ìºì‹œ ì „ì²´ í´ë¦¬ì–´
    }
}
```

## âš™ï¸ ì„¤ì •

### ê¸°ë³¸ ì„¤ì •

```yaml
near-cache:
  enabled: true                          # Near Cache í™œì„±í™”
  invalidation-channel: cache:invalidation  # Pub/Sub ì±„ë„ëª…
  
  l1:
    enabled: true                        # L1 ìºì‹œ í™œì„±í™”
    max-size: 10000                      # ìµœëŒ€ ì—”íŠ¸ë¦¬ ìˆ˜
    expire-after-write: 10m              # ì“°ê¸° í›„ ë§Œë£Œ ì‹œê°„
    
  l2:
    enabled: true                        # L2 ìºì‹œ í™œì„±í™”
    ttl: 1h                              # TTL
    key-prefix: "near-cache:"            # Redis key prefix
    cache-null-values: false             # null ê°’ ìºì‹± ì—¬ë¶€
```

### ìºì‹œë³„ ê°œë³„ ì„¤ì •

```yaml
near-cache:
  caches:
    userCache:
      l1-max-size: 5000
      l1-expire-after-write: 5m
      l2-ttl: 30m
    productCache:
      l1-max-size: 20000
      l1-expire-after-write: 15m
      l2-ttl: 2h
```

## ğŸ“¦ ê¸°ìˆ  ìŠ¤íƒ

- **Java 17+**
- **Spring Boot 3.x**
- **Caffeine** (L1 Local Cache)
- **Spring Data Redis** (L2 Global Cache)
- **Jackson** (JSON Serialization)

## ğŸ§ª í…ŒìŠ¤íŠ¸

```bash
./mvnw test
```

## ğŸ“ ë¼ì´ì„ ìŠ¤

MIT License

